<script type="text/javascript">
    RED.nodes.registerType('trafikanten-provider',{
        category: 'trafikanten',
        color: '#E60000',
        defaults: {
            name: {value:"Ruter sanntid"},
            configurationString: {value: "", required: true}
        },
        oneditprepare: function() {
            console.log("oneditprepare", arguments);
            Array.prototype.slice.call(document.querySelectorAll('dialog')).forEach(function(dialog) {
                dialog.addEventListener('close', function() {
                    console.log("Closing dialog", dialog);
                    if (dialog.returnValue === false) {
                        return;
                    }
                    var valueElements = dialog.querySelector("iframe").contentDocument.body.querySelectorAll("*[name]");
                    for (var i = 0; i < valueElements.length; i++) {
                        var valueElement = valueElements[i];
                        var formElement = document.querySelector("#dialog").querySelector("*[name='" + valueElement.name + "']");
                        console.log("formElement =", formElement);
                        if (formElement) {
                            formElement.value = valueElement.value;
                        }
                        console.log("valueElement =", valueElement);
                    }
                });
            });
        },
        inputs:1,
        outputs:1,
        icon: "hash.png",
        label: function() {
            return this.name||"Ruter sanntid";
        }
    });
    debugger;
/*
    stationNameField.addEventListener("change", function(evt) {
        console.log(stationNameField.value);
    }, false);
*/
</script>

<script type="text/x-red" data-template-name="trafikanten-provider">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" name="node-input-name" placeholder="Name">
        <label for="node-input-configurationString"><i class="icon-tag"></i>Configuration string</label>
        <input type="text" id="node-input-configurationString" name="favourite-string" readonly >
        <dialog id="minDialog">
            <iframe frameborder="0" src="/trafikantenprovider/selector-dialog.html" width="200" height="200"></iframe>
            <button type="button" onclick="document.querySelector('#minDialog').close()">OK</button>
            <button type="button" onclick="document.querySelector('#minDialog').close(false)">Avbryt</button>
        </dialog>
        <button type="button" onclick="document.querySelector('#minDialog').showModal()">Configure</button>
    </div>
</script>

<script type="text/x-red" data-help-name="trafikanten-provider">
    <p>A simple node that converts the message payloads into all lower-case characters</p>
</script>